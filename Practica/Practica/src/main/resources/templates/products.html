<!DOCTYPE html>
<html lang="es">
<head>
    <!-- ... (el head se mantiene igual) ... -->
</head>
<body>
<header class="header">
    <!-- ... (header se mantiene igual) ... -->
</header>

<main class="container">
    <section class="products">
        <h2>Todos los Productos</h2>
        <div class="product-list" id="product-list">
            {{#products}}
            <div class="product-card">
                <img src="/product/{{id}}/image" alt="{{name}}">
                <h3>{{name}}</h3>
                <p class="price">{{price}} €</p>
                <a href="/product/{{id}}" class="btn-details">Detalles</a>
            </div>
            {{/products}}
        </div>

        <!-- Spinner de carga -->
        <div id="spinner" class="spinner" style="display: none; text-align: center; margin: 20px 0;">
            <img src="/images/spinner.gif" alt="Cargando..." width="50">
        </div>

        <!-- Botón para cargar más productos -->
        <div class="load-more" style="text-align: center; margin: 20px 0;">
            <button id="load-more-btn" class="btn-details" style="padding: 10px 20px;">Cargar más productos</button>
        </div>

        <!-- Botón para añadir producto -->
        <div class="add-product" style="text-align: center; margin: 20px 0;">
            <a href="/newProduct" class="btn-details">Añadir Producto</a>
        </div>
    </section>
</main>

<footer class="footer">
    <!-- ... (footer se mantiene igual) ... -->
</footer>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        let currentPage = 1; // Empezamos en 1 porque la página 0 ya se cargó inicialmente
        const loadMoreBtn = document.getElementById("load-more-btn");
        const productList = document.getElementById("product-list");
        const spinner = document.getElementById("spinner");

        // Función para cargar más productos
        function loadMoreProducts() {
            spinner.style.display = "block";
            loadMoreBtn.style.display = "none";

            fetch(`/products?page=${currentPage}&size=10`, {
                headers: {
                    'X-Requested-With': 'XMLHttpRequest' // Indicamos que es AJAX
                }
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(html => {
                    // Parseamos el HTML y extraemos los productos
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const newProducts = doc.getElementById('product-list').innerHTML;

                    if (newProducts.trim() !== '') {
                        productList.innerHTML += newProducts;
                        currentPage++;
                        loadMoreBtn.style.display = "block";
                    } else {
                        // No hay más productos, ocultamos el botón
                        loadMoreBtn.style.display = "none";
                        // Opcional: mostrar mensaje de que no hay más productos
                        const noMoreProducts = document.createElement('p');
                        noMoreProducts.textContent = 'No hay más productos para mostrar';
                        noMoreProducts.style.textAlign = 'center';
                        noMoreProducts.style.margin = '20px 0';
                        loadMoreBtn.parentNode.appendChild(noMoreProducts);
                    }
                })
                .catch(error => {
                    console.error('Error al cargar más productos:', error);
                    loadMoreBtn.style.display = "block";
                    // Opcional: mostrar mensaje de error al usuario
                })
                .finally(() => {
                    spinner.style.display = "none";
                });
        }

        // Event listener para el botón
        loadMoreBtn.addEventListener('click', loadMoreProducts);

        // Verificar si inicialmente hay menos productos de los que caben en una página
        if (document.querySelectorAll('.product-card').length < 10) {
            loadMoreBtn.style.display = "none";
        }
    });
</script>
</body>
</html>