<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos - Juguetes Store</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<header class="header">
    <div class="top-bar"></div>
    <div class="container">
        <div class="logo">
            <a href="/"><img src="/images/logo-tienda-juguetes.jpg" alt="Juguetes Store" width="500"></a>
        </div>
        <nav class="nav">
            <ul>
                <li><a href="/">Inicio</a></li>
                <li><a href="/products/">Productos</a></li>
                <li><a href="/myAccount">Mi cuenta</a></li>
                <li><a href="/register">Registro</a></li>
                <li><a href="/contact">Contáctanos</a></li>
            </ul>
        </nav>
    </div>
</header>

<main class="container">
    <section class="products">
        <h2>Todos los Productos</h2>

        <!-- Aquí los productos se cargarán dinámicamente -->
        <div class="product-list" id="product-list">
            <!-- Los productos se insertarán aquí con JavaScript -->
        </div>

        <!-- Spinner para carga -->
        <div id="spinner" class="spinner" style="display: none;">
            <img src="/images/spinner.gif" alt="Cargando...">
        </div>

        <!-- Botón para cargar más productos -->
        <div class="load-more">
            <button id="load-more-btn">Más resultados</button>
        </div>
    </section>
</main>

<footer class="footer">
    <div class="container">
        <div class="footer-left">
            <img src="/images/logo-tienda-juguetes.jpg" alt="Juguetes Store" width="170">
        </div>
        <div class="footer-center">
            <p>&copy; 2025 Juguetes Store. Todos los derechos reservados.</p>
            <img src="/images/payment.gif" alt="Métodos de pago">
        </div>
        <div class="footer-right">
            <a href="/">Inicio</a>
            <a href="/ubication">Dónde encontrarnos</a>
            <a href="/contact">Contacto</a>
        </div>
    </div>
</footer>

<script>
    let currentPage = 0;
    const loadMoreBtn = document.getElementById("load-more-btn");
    const productList = document.getElementById("product-list");
    const spinner = document.getElementById("spinner");

    // Función para crear dinámicamente las tarjetas de producto
    function createProductCard(product) {
        const productCard = document.createElement("div");
        productCard.className = "product-card";  // Estilo de la tarjeta

        const img = document.createElement("img");
        img.src = product.image ? product.image : "/images/default-product.png"; // Imagen por defecto si no hay ninguna
        img.alt = product.name;
        img.className = "product-img";  // Clase para la imagen

        const productInfo = document.createElement("div");
        productInfo.className = "product-info"; // Caja de información del producto

        const h3 = document.createElement("h3");
        h3.textContent = product.name;

        const price = document.createElement("p");
        price.className = "price";  // Clase para el precio
        price.textContent = `${product.price} €`;

        const detailsLink = document.createElement("a");
        detailsLink.href = `/product/${product.id}`;
        detailsLink.className = "btn-details";  // Clase para el botón de detalles
        detailsLink.textContent = "Detalles";

        productInfo.appendChild(h3);
        productInfo.appendChild(price);
        productInfo.appendChild(detailsLink);

        productCard.appendChild(img);
        productCard.appendChild(productInfo);

        return productCard;
    }

    // Función para cargar productos usando AJAX
    function loadProducts() {
        spinner.style.display = "block"; // Mostrar spinner mientras se cargan productos
        loadMoreBtn.style.display = "none"; // Ocultar botón temporalmente

        fetch(`/products/loadMore?page=${currentPage}&size=10`)
            .then(response => response.json())
            .then(products => {
                spinner.style.display = "none"; // Ocultar spinner

                if (products.length > 0) {
                    products.forEach(product => {
                        const productCard = createProductCard(product);
                        productList.appendChild(productCard); // Añadir tarjetas de producto al contenedor
                    });

                    currentPage++; // Incrementar página para próxima carga
                    loadMoreBtn.style.display = "block"; // Mostrar el botón si hay más productos
                } else {
                    loadMoreBtn.style.display = "none"; // Ocultar el botón si no hay más productos
                }
            })
            .catch(error => {
                console.error("Error cargando productos:", error);
                spinner.style.display = "none";
                loadMoreBtn.style.display = "block"; // Restaurar el botón en caso de error
            });
    }

    // Cargar la primera tanda de productos al cargar la página
    document.addEventListener("DOMContentLoaded", loadProducts);

    // Cargar más productos al hacer clic en el botón
    loadMoreBtn.addEventListener("click", loadProducts);
</script>

</body>
</html>
